<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Trail | Rooted in the Word üå±</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --border:#cfcfcf;
      --ink:#111;
      --muted:#666;
      --panel:#fff;
      --bg:#fff;
      --soft:#fafafa;
      --accent:#1E293B;
      --chip:#f3f4f6;
    }

    body{
      margin:0;
      background:var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color:var(--ink);
    }

    .wrap{
      padding:14px;
      max-width:820px;
      margin:0 auto;
    }

    .card{
      border:3px solid var(--ink);
      border-radius:18px;
      padding:14px;
      background:var(--panel);
      display:grid;
      gap:12px;
    }

    .titleRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .title{
      font-weight:900;
      font-size:18px;
    }

    .subtitle{
      color:var(--muted);
      font-weight:700;
      font-size:13px;
    }

    .helpBtn{
      -webkit-appearance:none;
      appearance:none;
      border:none;
      background:transparent;
      padding:0;
      font-weight:900;
      cursor:pointer;
      color:var(--muted);
    }

    .helpBox{
      border:1px dashed var(--border);
      border-radius:12px;
      padding:10px 12px;
      background:var(--soft);
      font-size:14px;
      line-height:1.5;
    }

    .helpBox em{
      font-family: "EB Garamond", Garamond, serif;
      font-size:15px;
      font-weight:600;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:740px){
      .grid2{ grid-template-columns: 1fr 1fr; }
    }

    label{
      font-weight:900;
      font-size:14px;
      display:block;
      margin-bottom:6px;
    }

    input[type="text"], textarea{
      width:100%;
      box-sizing:border-box;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      font-size:14px;
      font-weight:700;
      font-family: inherit;
      background:#fff;
    }

    textarea{
      resize:vertical;
      min-height:140px;
      line-height:1.45;
      font-weight:700;
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .btnRow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      -webkit-appearance:none;
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:8px 10px;
      font-weight:800;
      cursor:pointer;
    }

    .miniBtn{
      padding:6px 8px;
      font-size:12px;
      border-radius:9px;
    }

    .softRule{
      border:none;
      border-top:1px solid #e5e5e5;
      margin:4px 0;
    }

    /* Verse cards */
    .verseList{
      display:grid;
      gap:10px;
    }

    .verseCard{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px;
      background:#fff;
      display:grid;
      gap:10px;
    }

    .verseTop{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
    }

    .verseIndex{
      font-weight:900;
      font-size:13px;
      color:var(--muted);
    }

    .verseText{
      font-size:15px;
      font-weight:900;
      line-height:1.5;
      word-wrap:break-word;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .chip{
      border:1px solid var(--border);
      background:var(--chip);
      border-radius:999px;
      padding:6px 10px;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .chip[aria-pressed="true"]{
      background:#fff;
      border:2px solid var(--ink);
    }

    /* Slider sparkle */
    .sparkleBox{
      border:1px dashed var(--border);
      border-radius:12px;
      padding:10px 12px;
      background:var(--soft);
      display:grid;
      gap:8px;
    }

    .sparkleRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    input[type="range"]{
      width: 240px;
      max-width: 100%;
    }

    .sparklePrompt{
      color:var(--accent);
      font-weight:900;
      line-height:1.45;
    }

    /* Summary */
    .summary{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px;
      background:#fff;
      display:grid;
      gap:10px;
    }

    .summaryStats{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .stat{
      background:var(--soft);
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 10px;
      font-weight:900;
      font-size:12px;
    }

    .group{
      border-top:1px solid #e5e5e5;
      padding-top:8px;
      display:grid;
      gap:6px;
    }

    .groupTitle{
      font-weight:900;
      color:var(--muted);
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.04em;
    }

    .listItem{
      font-weight:800;
      line-height:1.4;
      font-size:14px;
    }

    .noteLabel{
      font-weight:900;
      font-size:13px;
      color:var(--muted);
      margin-top:2px;
    }

    .small{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <section class="card" aria-label="Word Trail Tool">

      <div class="titleRow">
        <div>
          <div class="title">Word Trail üåø</div>
          <div class="subtitle">Trace a word/theme across verses, tag the flavor, and summarize what you‚Äôre seeing.</div>
        </div>

        <button class="helpBtn" id="helpToggle" type="button" aria-expanded="false" aria-controls="helpBox">
          How to use
        </button>
      </div>

      <div id="helpBox" class="helpBox" hidden>
        <strong>What this is:</strong> A lightweight word/theme tracer. You paste multiple verses, then tag each one by what it‚Äôs doing (promise, command, comfort, warning).<br><br>
        <strong>How to use:</strong>
        <ol style="margin:8px 0 8px 18px; padding:0;">
          <li>Type a theme (ex: ‚Äústeadfast love‚Äù, ‚Äúwrath‚Äù, ‚Äúremember‚Äù).</li>
          <li>Paste verses below (one per paragraph, or separated by blank lines).</li>
          <li>Click tags on each verse card.</li>
          <li>Use the Comfort ‚Üî Confrontation slider to choose your reflection angle.</li>
        </ol>
        <em>This isn‚Äôt a test. It‚Äôs a trail walk. Slow feet welcome.</em>
      </div>

      <div class="grid2">
        <div>
          <label for="themeInput">Theme / word you‚Äôre tracing</label>
          <input id="themeInput" type="text" placeholder='Example: "justice" or "steadfast love"' />
          <div class="small">Optional: add a note like ‚Äútheodicy‚Äù or ‚Äúattributes of God‚Äù if you want.</div>
        </div>

        <div class="sparkleBox">
          <div class="sparkleRow">
            <div style="font-weight:900;">Reflection angle ‚ú®</div>
            <div class="small"><span id="sparkleLabel">Balanced</span></div>
          </div>

          <div class="sparkleRow">
            <div class="small">Comfort</div>
            <input id="sparkleRange" type="range" min="0" max="100" value="50" />
            <div class="small">Confrontation</div>
          </div>

          <div class="sparklePrompt" id="sparklePrompt">
            What does this theme reveal about God, and what does it ask of you?
          </div>
        </div>
      </div>

      <div>
        <label for="versesInput">Paste verses (one per paragraph)</label>
        <textarea id="versesInput" placeholder="Paste multiple verses here.

Tip: Separate verses with a blank line.
You can include references (like Psalm 1:3) and the tool will keep them with the verse."></textarea>

        <div class="row" style="margin-top:8px;">
          <div class="btnRow">
            <button id="buildBtn" type="button">Build cards</button>
            <button id="clearBtn" type="button" class="miniBtn">Clear</button>
          </div>

          <div class="btnRow">
            <button id="copySummaryBtn" type="button" class="miniBtn">Copy summary</button>
            <button id="downloadBtn" type="button" class="miniBtn">Download JSON</button>
          </div>
        </div>
      </div>

      <hr class="softRule" />

      <div>
        <div class="row">
          <div style="font-weight:900;">Verse cards</div>
          <div class="small" id="countLabel">0 verses</div>
        </div>

        <div class="verseList" id="verseList"></div>
      </div>

      <hr class="softRule" />

      <div>
        <div class="row">
          <div style="font-weight:900;">Summary board</div>
          <div class="small">Auto-updates as you tag verses.</div>
        </div>

        <div class="summary" id="summaryBox">
          <div class="summaryStats" id="statsRow"></div>

          <div class="group" id="groupPromise">
            <div class="groupTitle">Promise</div>
            <div class="small" id="promiseEmpty">No verses tagged yet.</div>
            <div id="promiseList"></div>
          </div>

          <div class="group" id="groupCommand">
            <div class="groupTitle">Command</div>
            <div class="small" id="commandEmpty">No verses tagged yet.</div>
            <div id="commandList"></div>
          </div>

          <div class="group" id="groupComfort">
            <div class="groupTitle">Comfort</div>
            <div class="small" id="comfortEmpty">No verses tagged yet.</div>
            <div id="comfortList"></div>
          </div>

          <div class="group" id="groupWarning">
            <div class="groupTitle">Warning</div>
            <div class="small" id="warningEmpty">No verses tagged yet.</div>
            <div id="warningList"></div>
          </div>

          <div class="group" id="groupOther">
            <div class="groupTitle">Other</div>
            <div class="small" id="otherEmpty">No verses tagged yet.</div>
            <div id="otherList"></div>
          </div>

          <div class="group">
            <div class="groupTitle">Your notes</div>

            <div class="noteLabel">Most repeated idea I see</div>
            <textarea id="noteRepeated" placeholder="What keeps showing up?"></textarea>

            <div class="noteLabel">Tension I notice (if any)</div>
            <textarea id="noteTension" placeholder="Comfort + confrontation in the same theme? Where do you feel it?"></textarea>

            <div class="noteLabel">What this teaches me about God</div>
            <textarea id="noteGod" placeholder="Attribute, action, promise, holiness, patience, justice, mercy, etc."></textarea>

            <div class="noteLabel">What this calls me to do</div>
            <textarea id="noteDo" placeholder="One small obedience step. One prayer. One reframe."></textarea>
          </div>
        </div>
      </div>

    </section>
  </div>

  <script>
    const TAGS = ["Promise","Command","Comfort","Warning","Other"];

    const helpToggle = document.getElementById("helpToggle");
    const helpBox = document.getElementById("helpBox");

    const themeInput = document.getElementById("themeInput");
    const sparkleRange = document.getElementById("sparkleRange");
    const sparkleLabel = document.getElementById("sparkleLabel");
    const sparklePrompt = document.getElementById("sparklePrompt");

    const versesInput = document.getElementById("versesInput");
    const buildBtn = document.getElementById("buildBtn");
    const clearBtn = document.getElementById("clearBtn");
    const copySummaryBtn = document.getElementById("copySummaryBtn");
    const downloadBtn = document.getElementById("downloadBtn");

    const verseList = document.getElementById("verseList");
    const countLabel = document.getElementById("countLabel");

    const statsRow = document.getElementById("statsRow");

    const lists = {
      Promise: document.getElementById("promiseList"),
      Command: document.getElementById("commandList"),
      Comfort: document.getElementById("comfortList"),
      Warning: document.getElementById("warningList"),
      Other: document.getElementById("otherList")
    };
    const empties = {
      Promise: document.getElementById("promiseEmpty"),
      Command: document.getElementById("commandEmpty"),
      Comfort: document.getElementById("comfortEmpty"),
      Warning: document.getElementById("warningEmpty"),
      Other: document.getElementById("otherEmpty")
    };

    const noteRepeated = document.getElementById("noteRepeated");
    const noteTension = document.getElementById("noteTension");
    const noteGod = document.getElementById("noteGod");
    const noteDo = document.getElementById("noteDo");

    let model = {
      theme: "",
      angle: 50,
      verses: [] // { id, text, tags: Set }
    };

    helpToggle.addEventListener("click", () => {
      const expanded = helpToggle.getAttribute("aria-expanded") === "true";
      helpToggle.setAttribute("aria-expanded", String(!expanded));
      helpBox.hidden = expanded;
    });

    function updateSparkle(){
      const v = Number(sparkleRange.value);
      model.angle = v;

      if(v <= 20){
        sparkleLabel.textContent = "Mostly comfort";
        sparklePrompt.textContent = "Where is God meeting weakness with mercy here, and how can you receive it without rushing?";
      } else if(v <= 40){
        sparkleLabel.textContent = "Leaning comfort";
        sparklePrompt.textContent = "What steady comfort does this theme offer, and what fear does it gently quiet?";
      } else if(v < 60){
        sparkleLabel.textContent = "Balanced";
        sparklePrompt.textContent = "What does this theme reveal about God, and what does it ask of you?";
      } else if(v < 80){
        sparkleLabel.textContent = "Leaning confrontation";
        sparklePrompt.textContent = "What does this theme challenge or correct in you, and what does repentance/obedience look like today?";
      } else {
        sparkleLabel.textContent = "Mostly confrontation";
        sparklePrompt.textContent = "What does this theme refuse to let you ignore, and what faithful next step does it demand?";
      }
    }

    sparkleRange.addEventListener("input", updateSparkle);
    updateSparkle();

    function splitVerses(raw){
      const cleaned = (raw || "").trim();
      if(!cleaned) return [];
      // Split on blank lines (one or more)
      const parts = cleaned.split(/\n\s*\n+/g).map(s => s.trim()).filter(Boolean);
      return parts;
    }

    function buildCards(){
      const parts = splitVerses(versesInput.value);
      model.theme = (themeInput.value || "").trim();

      model.verses = parts.map((text, idx) => ({
        id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now() + idx),
        text,
        tags: new Set()
      }));

      renderCards();
      renderSummary();
    }

    function renderCards(){
      verseList.innerHTML = "";
      countLabel.textContent = `${model.verses.length} verse${model.verses.length === 1 ? "" : "s"}`;

      model.verses.forEach((v, index) => {
        const card = document.createElement("div");
        card.className = "verseCard";

        const top = document.createElement("div");
        top.className = "verseTop";

        const idx = document.createElement("div");
        idx.className = "verseIndex";
        idx.textContent = `#${index + 1}`;

        const chips = document.createElement("div");
        chips.className = "chips";

        TAGS.forEach(tag => {
          const chip = document.createElement("button");
          chip.type = "button";
          chip.className = "chip";
          chip.textContent = tag;
          chip.setAttribute("aria-pressed", v.tags.has(tag) ? "true" : "false");

          chip.addEventListener("click", () => {
            if(v.tags.has(tag)) v.tags.delete(tag);
            else v.tags.add(tag);

            chip.setAttribute("aria-pressed", v.tags.has(tag) ? "true" : "false");
            renderSummary();
          });

          chips.appendChild(chip);
        });

        top.appendChild(idx);
        top.appendChild(chips);

        const text = document.createElement("div");
        text.className = "verseText";
        text.textContent = v.text;

        card.appendChild(top);
        card.appendChild(text);

        verseList.appendChild(card);
      });
    }

    function tagCounts(){
      const counts = Object.fromEntries(TAGS.map(t => [t, 0]));
      model.verses.forEach(v => {
        v.tags.forEach(t => { if(counts[t] !== undefined) counts[t]++; });
      });
      return counts;
    }

    function mostCommonTag(counts){
      const entries = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
      const top = entries[0];
      if(!top || top[1] === 0) return "None yet";
      return `${top[0]} (${top[1]})`;
    }

    function renderSummary(){
      // Clear lists
      TAGS.forEach(t => {
        lists[t].innerHTML = "";
        empties[t].style.display = "block";
      });

      // Fill lists
      model.verses.forEach((v, i) => {
        v.tags.forEach(tag => {
          const item = document.createElement("div");
          item.className = "listItem";
          item.textContent = `#${i+1} ${v.text}`;
          lists[tag].appendChild(item);
          empties[tag].style.display = "none";
        });
      });

      // Stats
      const counts = tagCounts();
      statsRow.innerHTML = "";

      const total = document.createElement("div");
      total.className = "stat";
      total.textContent = `Verses: ${model.verses.length}`;
      statsRow.appendChild(total);

      const theme = document.createElement("div");
      theme.className = "stat";
      theme.textContent = model.theme ? `Theme: ${model.theme}` : "Theme: (blank)";
      statsRow.appendChild(theme);

      TAGS.forEach(t => {
        const s = document.createElement("div");
        s.className = "stat";
        s.textContent = `${t}: ${counts[t]}`;
        statsRow.appendChild(s);
      });

      const top = document.createElement("div");
      top.className = "stat";
      top.textContent = `Most common: ${mostCommonTag(counts)}`;
      statsRow.appendChild(top);
    }

    function buildSummaryText(){
      const counts = tagCounts();
      const lines = [];

      lines.push(`WORD TRAIL`);
      lines.push(`Theme: ${model.theme || "(blank)"}`);
      lines.push(`Angle: ${sparkleLabel.textContent}`);
      lines.push(`Prompt: ${sparklePrompt.textContent}`);
      lines.push(``);

      lines.push(`Tag counts:`);
      TAGS.forEach(t => lines.push(`- ${t}: ${counts[t]}`));
      lines.push(`Most common: ${mostCommonTag(counts)}`);
      lines.push(``);

      TAGS.forEach(tag => {
        lines.push(`${tag.toUpperCase()}:`);
        const tagged = model.verses
          .map((v, i) => ({ v, i }))
          .filter(x => x.v.tags.has(tag));

        if(tagged.length === 0){
          lines.push(`(none)`);
        } else {
          tagged.forEach(x => lines.push(`#${x.i+1} ${x.v.text}`));
        }
        lines.push(``);
      });

      lines.push(`NOTES:`);
      lines.push(`Most repeated idea: ${noteRepeated.value || ""}`);
      lines.push(`Tension I notice: ${noteTension.value || ""}`);
      lines.push(`About God: ${noteGod.value || ""}`);
      lines.push(`Calls me to do: ${noteDo.value || ""}`);

      return lines.join("\n");
    }

    async function copySummary(){
      const text = buildSummaryText();
      try{
        await navigator.clipboard.writeText(text);
        copySummaryBtn.textContent = "Copied!";
        setTimeout(()=>copySummaryBtn.textContent="Copy summary", 900);
      } catch(e){
        alert("Copy failed (browser blocked clipboard). You can manually select text after downloading JSON.");
      }
    }

    function downloadJSON(){
      const payload = {
        theme: model.theme,
        angleLabel: sparkleLabel.textContent,
        prompt: sparklePrompt.textContent,
        verses: model.verses.map(v => ({ text: v.text, tags: Array.from(v.tags) })),
        notes: {
          repeatedIdea: noteRepeated.value || "",
          tension: noteTension.value || "",
          aboutGod: noteGod.value || "",
          callsMeToDo: noteDo.value || ""
        },
        exportedAt: new Date().toISOString()
      };

      const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "word-trail.json";
      document.body.appendChild(a);
      a.click();
      a.remove();

      URL.revokeObjectURL(url);
    }

    function clearAll(){
      themeInput.value = "";
      versesInput.value = "";
      noteRepeated.value = "";
      noteTension.value = "";
      noteGod.value = "";
      noteDo.value = "";
      model = { theme:"", angle: model.angle, verses: [] };
      verseList.innerHTML = "";
      countLabel.textContent = "0 verses";
      renderSummary();
    }

    buildBtn.addEventListener("click", buildCards);
    clearBtn.addEventListener("click", clearAll);
    copySummaryBtn.addEventListener("click", copySummary);
    downloadBtn.addEventListener("click", downloadJSON);

    // Initial empty summary
    renderSummary();
  </script>
</body>
</html>
